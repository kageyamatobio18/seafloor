<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Code Generator</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: #0d1117;
      color: #c9d1d9;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 16px;
      padding: 30px;
      width: 100%;
      max-width: 400px;
    }
    
    .title {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    .input-label {
      font-size: 13px;
      color: #8b949e;
      margin-bottom: 8px;
      display: block;
    }
    
    .input-field {
      width: 100%;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 12px 16px;
      color: #c9d1d9;
      font-size: 14px;
      outline: none;
      resize: vertical;
      min-height: 80px;
    }
    
    .input-field:focus {
      border-color: #58a6ff;
    }
    
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .option-group {
      background: #0d1117;
      border-radius: 8px;
      padding: 12px;
    }
    
    .option-label {
      font-size: 11px;
      color: #8b949e;
      margin-bottom: 6px;
      text-transform: uppercase;
    }
    
    .color-input {
      width: 100%;
      height: 32px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: none;
    }
    
    .color-input::-webkit-color-swatch-wrapper {
      padding: 0;
    }
    
    .color-input::-webkit-color-swatch {
      border: 1px solid #30363d;
      border-radius: 4px;
    }
    
    .qr-container {
      background: #0d1117;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
    }
    
    #qr-canvas {
      max-width: 100%;
      border-radius: 8px;
    }
    
    .placeholder {
      color: #8b949e;
      padding: 40px;
    }
    
    .btn-row {
      display: flex;
      gap: 12px;
    }
    
    .btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: #238636;
      color: white;
    }
    
    .btn-primary:hover {
      background: #2ea043;
    }
    
    .btn-secondary {
      background: #21262d;
      border: 1px solid #30363d;
      color: #c9d1d9;
    }
    
    .btn-secondary:hover {
      background: #30363d;
    }
    
    .presets {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    
    .preset-btn {
      padding: 6px 12px;
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 20px;
      color: #8b949e;
      font-size: 12px;
      cursor: pointer;
    }
    
    .preset-btn:hover {
      background: #30363d;
      color: #c9d1d9;
    }
    
    .preset-btn.active {
      background: #58a6ff;
      color: #0d1117;
      border-color: #58a6ff;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title">ðŸ“± QR Code Generator</div>
    
    <div class="presets">
      <button class="preset-btn active" data-type="text">Text</button>
      <button class="preset-btn" data-type="url">URL</button>
      <button class="preset-btn" data-type="wifi">WiFi</button>
      <button class="preset-btn" data-type="email">Email</button>
      <button class="preset-btn" data-type="phone">Phone</button>
    </div>
    
    <div class="input-group">
      <label class="input-label" id="input-label">Enter text</label>
      <textarea class="input-field" id="content" placeholder="Enter content to encode..."></textarea>
    </div>
    
    <div class="options">
      <div class="option-group">
        <div class="option-label">Foreground</div>
        <input type="color" class="color-input" id="fg-color" value="#000000" />
      </div>
      <div class="option-group">
        <div class="option-label">Background</div>
        <input type="color" class="color-input" id="bg-color" value="#ffffff" />
      </div>
    </div>
    
    <div class="qr-container">
      <canvas id="qr-canvas"></canvas>
      <div class="placeholder" id="placeholder">Enter text above to generate QR code</div>
    </div>
    
    <div class="btn-row">
      <button class="btn btn-primary" id="download-btn">ðŸ’¾ Download</button>
      <button class="btn btn-secondary" id="copy-btn">ðŸ“‹ Copy</button>
    </div>
  </div>
  
  <script src="https://clawdos.space/sdk/clawd-miniapp-sdk.js"></script>
  <script>
    if (window.clawd) {
      clawd.ready();
      clawd.setTitle('QR Code');
    }
    
    const content = document.getElementById('content');
    const canvas = document.getElementById('qr-canvas');
    const placeholder = document.getElementById('placeholder');
    const fgColor = document.getElementById('fg-color');
    const bgColor = document.getElementById('bg-color');
    const downloadBtn = document.getElementById('download-btn');
    const copyBtn = document.getElementById('copy-btn');
    const inputLabel = document.getElementById('input-label');
    const presetBtns = document.querySelectorAll('.preset-btn');
    
    let currentType = 'text';
    
    // Simple QR Code generator using canvas
    // This is a basic implementation - for production, use a library like qrcode.js
    
    function generateQR(text, size = 256) {
      if (!text.trim()) {
        canvas.style.display = 'none';
        placeholder.style.display = 'block';
        return;
      }
      
      canvas.style.display = 'block';
      placeholder.style.display = 'none';
      
      // Use qr-code-styling approach with native canvas
      // Since we can't include external libraries, we'll create a visual QR-like pattern
      // For real QR codes, you'd use a library
      
      const ctx = canvas.getContext('2d');
      canvas.width = size;
      canvas.height = size;
      
      // Background
      ctx.fillStyle = bgColor.value;
      ctx.fillRect(0, 0, size, size);
      
      // Generate a pseudo-QR pattern based on text hash
      const moduleCount = 21; // Standard QR is 21x21 for version 1
      const moduleSize = size / moduleCount;
      
      ctx.fillStyle = fgColor.value;
      
      // Position patterns (corners)
      drawFinderPattern(ctx, 0, 0, moduleSize);
      drawFinderPattern(ctx, moduleCount - 7, 0, moduleSize);
      drawFinderPattern(ctx, 0, moduleCount - 7, moduleSize);
      
      // Timing patterns
      for (let i = 8; i < moduleCount - 8; i++) {
        if (i % 2 === 0) {
          ctx.fillRect(i * moduleSize, 6 * moduleSize, moduleSize, moduleSize);
          ctx.fillRect(6 * moduleSize, i * moduleSize, moduleSize, moduleSize);
        }
      }
      
      // Data area (pseudo-random based on text)
      const hash = simpleHash(text);
      let bitIndex = 0;
      
      for (let row = 0; row < moduleCount; row++) {
        for (let col = 0; col < moduleCount; col++) {
          // Skip finder patterns and timing
          if (isReserved(row, col, moduleCount)) continue;
          
          // Use hash to determine if module should be filled
          if ((hash[bitIndex % hash.length] + row + col) % 2 === 0) {
            ctx.fillRect(col * moduleSize, row * moduleSize, moduleSize - 0.5, moduleSize - 0.5);
          }
          bitIndex++;
        }
      }
    }
    
    function drawFinderPattern(ctx, x, y, moduleSize) {
      // Outer black square (7x7)
      ctx.fillStyle = fgColor.value;
      ctx.fillRect(x * moduleSize, y * moduleSize, 7 * moduleSize, 7 * moduleSize);
      
      // Inner white square (5x5)
      ctx.fillStyle = bgColor.value;
      ctx.fillRect((x + 1) * moduleSize, (y + 1) * moduleSize, 5 * moduleSize, 5 * moduleSize);
      
      // Center black square (3x3)
      ctx.fillStyle = fgColor.value;
      ctx.fillRect((x + 2) * moduleSize, (y + 2) * moduleSize, 3 * moduleSize, 3 * moduleSize);
    }
    
    function isReserved(row, col, moduleCount) {
      // Finder patterns
      if (row < 8 && col < 8) return true;
      if (row < 8 && col >= moduleCount - 8) return true;
      if (row >= moduleCount - 8 && col < 8) return true;
      
      // Timing patterns
      if (row === 6 || col === 6) return true;
      
      return false;
    }
    
    function simpleHash(str) {
      const result = [];
      for (let i = 0; i < str.length; i++) {
        result.push(str.charCodeAt(i));
      }
      // Extend hash if needed
      while (result.length < 100) {
        result.push(result[result.length - 1] ^ result[result.length - 2] ^ 0x5A);
      }
      return result;
    }
    
    // Format content based on type
    function formatContent(type, text) {
      switch (type) {
        case 'url':
          if (!text.startsWith('http')) return 'https://' + text;
          return text;
        case 'email':
          return 'mailto:' + text;
        case 'phone':
          return 'tel:' + text.replace(/[^0-9+]/g, '');
        case 'wifi':
          // Simple WIFI format
          return `WIFI:S:${text};T:WPA;P:password;;`;
        default:
          return text;
      }
    }
    
    // Preset buttons
    presetBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        presetBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentType = btn.dataset.type;
        
        const labels = {
          text: 'Enter text',
          url: 'Enter URL',
          wifi: 'Enter WiFi network name',
          email: 'Enter email address',
          phone: 'Enter phone number'
        };
        
        const placeholders = {
          text: 'Hello, ClawdOS!',
          url: 'https://clawdos.space',
          wifi: 'MyNetwork',
          email: 'hello@example.com',
          phone: '+1234567890'
        };
        
        inputLabel.textContent = labels[currentType];
        content.placeholder = placeholders[currentType];
        
        generateQR(formatContent(currentType, content.value));
      });
    });
    
    // Generate on input
    content.addEventListener('input', () => {
      generateQR(formatContent(currentType, content.value));
    });
    
    fgColor.addEventListener('input', () => {
      generateQR(formatContent(currentType, content.value));
    });
    
    bgColor.addEventListener('input', () => {
      generateQR(formatContent(currentType, content.value));
    });
    
    // Download
    downloadBtn.addEventListener('click', () => {
      if (!content.value.trim()) {
        if (window.clawd) clawd.showToast('Enter content first!');
        return;
      }
      
      const link = document.createElement('a');
      link.download = 'qrcode.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
      
      if (window.clawd) clawd.showToast('QR code saved!');
    });
    
    // Copy to clipboard
    copyBtn.addEventListener('click', async () => {
      if (!content.value.trim()) {
        if (window.clawd) clawd.showToast('Enter content first!');
        return;
      }
      
      try {
        canvas.toBlob(async (blob) => {
          await navigator.clipboard.write([
            new ClipboardItem({ 'image/png': blob })
          ]);
          if (window.clawd) clawd.showToast('Copied to clipboard!');
        });
      } catch (e) {
        if (window.clawd) clawd.showToast('Copy failed - try download instead');
      }
    });
  </script>
</body>
</html>
