<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: #0d1117;
      color: #c9d1d9;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .game-container {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 16px;
      padding: 20px;
      text-align: center;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #30363d;
    }
    
    .title {
      font-size: 24px;
      font-weight: 700;
      color: #3fb950;
    }
    
    .score {
      font-size: 18px;
      color: #58a6ff;
    }
    
    .score span {
      color: #f0883e;
      font-weight: 700;
    }
    
    canvas {
      background: #0d1117;
      border: 2px solid #30363d;
      border-radius: 8px;
      display: block;
    }
    
    .controls {
      margin-top: 16px;
      display: flex;
      gap: 8px;
      justify-content: center;
    }
    
    .btn {
      background: #21262d;
      border: 1px solid #30363d;
      color: #c9d1d9;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .btn:hover {
      background: #30363d;
    }
    
    .btn-primary {
      background: #238636;
      border-color: #238636;
    }
    
    .btn-primary:hover {
      background: #2ea043;
    }
    
    .instructions {
      margin-top: 12px;
      font-size: 12px;
      color: #8b949e;
    }
    
    .game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(13, 17, 23, 0.95);
      padding: 30px 40px;
      border-radius: 12px;
      border: 2px solid #f85149;
      text-align: center;
      display: none;
    }
    
    .game-over.show {
      display: block;
    }
    
    .game-over h2 {
      color: #f85149;
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .game-over p {
      color: #8b949e;
      margin-bottom: 20px;
    }
    
    .high-score {
      margin-top: 8px;
      font-size: 13px;
      color: #a371f7;
    }
    
    /* Mobile controls */
    .mobile-controls {
      display: none;
      margin-top: 16px;
      gap: 8px;
    }
    
    @media (max-width: 600px) {
      .mobile-controls {
        display: grid;
        grid-template-columns: repeat(3, 50px);
        grid-template-rows: repeat(2, 50px);
        justify-content: center;
      }
    }
    
    .mobile-btn {
      background: #21262d;
      border: 1px solid #30363d;
      color: #c9d1d9;
      font-size: 20px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .mobile-btn:active {
      background: #30363d;
    }
    
    .mobile-btn.up { grid-column: 2; }
    .mobile-btn.left { grid-column: 1; grid-row: 2; }
    .mobile-btn.down { grid-column: 2; grid-row: 2; }
    .mobile-btn.right { grid-column: 3; grid-row: 2; }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="header">
      <div class="title">üêç Snake</div>
      <div class="score">Score: <span id="score">0</span></div>
    </div>
    
    <div style="position: relative;">
      <canvas id="game" width="400" height="400"></canvas>
      <div class="game-over" id="game-over">
        <h2>Game Over!</h2>
        <p>Final Score: <span id="final-score">0</span></p>
        <button class="btn btn-primary" onclick="startGame()">Play Again</button>
      </div>
    </div>
    
    <div class="controls">
      <button class="btn btn-primary" id="start-btn" onclick="startGame()">Start Game</button>
      <button class="btn" onclick="pauseGame()">Pause</button>
    </div>
    
    <div class="mobile-controls">
      <button class="mobile-btn up" onclick="setDirection(0, -1)">‚Üë</button>
      <button class="mobile-btn left" onclick="setDirection(-1, 0)">‚Üê</button>
      <button class="mobile-btn down" onclick="setDirection(0, 1)">‚Üì</button>
      <button class="mobile-btn right" onclick="setDirection(1, 0)">‚Üí</button>
    </div>
    
    <div class="instructions">
      Arrow keys or WASD to move ‚Ä¢ Space to pause
    </div>
    
    <div class="high-score">
      High Score: <span id="high-score">0</span>
    </div>
  </div>
  
  <script src="https://clawdos.space/sdk/clawd-miniapp-sdk.js"></script>
  <script>
    if (window.clawd) {
      clawd.ready();
      clawd.setTitle('Snake');
    }
    
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const finalScoreEl = document.getElementById('final-score');
    const highScoreEl = document.getElementById('high-score');
    const gameOverEl = document.getElementById('game-over');
    const startBtn = document.getElementById('start-btn');
    
    const gridSize = 20;
    const tileCount = canvas.width / gridSize;
    
    let snake = [];
    let food = {};
    let dx = 0;
    let dy = 0;
    let score = 0;
    let highScore = parseInt(localStorage.getItem('snake-high-score') || '0');
    let gameLoop = null;
    let gameRunning = false;
    let gamePaused = false;
    
    highScoreEl.textContent = highScore;
    
    function initGame() {
      snake = [
        { x: 10, y: 10 },
        { x: 9, y: 10 },
        { x: 8, y: 10 }
      ];
      dx = 1;
      dy = 0;
      score = 0;
      scoreEl.textContent = score;
      placeFood();
    }
    
    function placeFood() {
      food = {
        x: Math.floor(Math.random() * tileCount),
        y: Math.floor(Math.random() * tileCount)
      };
      // Don't place on snake
      for (const segment of snake) {
        if (segment.x === food.x && segment.y === food.y) {
          placeFood();
          return;
        }
      }
    }
    
    function draw() {
      // Clear
      ctx.fillStyle = '#0d1117';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw grid (subtle)
      ctx.strokeStyle = '#21262d';
      ctx.lineWidth = 0.5;
      for (let i = 0; i <= tileCount; i++) {
        ctx.beginPath();
        ctx.moveTo(i * gridSize, 0);
        ctx.lineTo(i * gridSize, canvas.height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, i * gridSize);
        ctx.lineTo(canvas.width, i * gridSize);
        ctx.stroke();
      }
      
      // Draw food
      ctx.fillStyle = '#f85149';
      ctx.beginPath();
      ctx.arc(
        food.x * gridSize + gridSize / 2,
        food.y * gridSize + gridSize / 2,
        gridSize / 2 - 2,
        0,
        Math.PI * 2
      );
      ctx.fill();
      
      // Draw snake
      snake.forEach((segment, index) => {
        if (index === 0) {
          // Head
          ctx.fillStyle = '#3fb950';
        } else {
          // Body gradient
          const brightness = 1 - (index / snake.length) * 0.4;
          ctx.fillStyle = `hsl(140, 70%, ${40 * brightness}%)`;
        }
        
        ctx.beginPath();
        ctx.roundRect(
          segment.x * gridSize + 1,
          segment.y * gridSize + 1,
          gridSize - 2,
          gridSize - 2,
          4
        );
        ctx.fill();
        
        // Eyes on head
        if (index === 0) {
          ctx.fillStyle = '#0d1117';
          const eyeSize = 3;
          const eyeOffset = 5;
          
          if (dx === 1) {
            ctx.beginPath();
            ctx.arc(segment.x * gridSize + gridSize - 5, segment.y * gridSize + 6, eyeSize, 0, Math.PI * 2);
            ctx.arc(segment.x * gridSize + gridSize - 5, segment.y * gridSize + 14, eyeSize, 0, Math.PI * 2);
            ctx.fill();
          } else if (dx === -1) {
            ctx.beginPath();
            ctx.arc(segment.x * gridSize + 5, segment.y * gridSize + 6, eyeSize, 0, Math.PI * 2);
            ctx.arc(segment.x * gridSize + 5, segment.y * gridSize + 14, eyeSize, 0, Math.PI * 2);
            ctx.fill();
          } else if (dy === -1) {
            ctx.beginPath();
            ctx.arc(segment.x * gridSize + 6, segment.y * gridSize + 5, eyeSize, 0, Math.PI * 2);
            ctx.arc(segment.x * gridSize + 14, segment.y * gridSize + 5, eyeSize, 0, Math.PI * 2);
            ctx.fill();
          } else if (dy === 1) {
            ctx.beginPath();
            ctx.arc(segment.x * gridSize + 6, segment.y * gridSize + gridSize - 5, eyeSize, 0, Math.PI * 2);
            ctx.arc(segment.x * gridSize + 14, segment.y * gridSize + gridSize - 5, eyeSize, 0, Math.PI * 2);
            ctx.fill();
          }
        }
      });
    }
    
    function update() {
      if (!gameRunning || gamePaused) return;
      
      // New head position
      const head = { x: snake[0].x + dx, y: snake[0].y + dy };
      
      // Wall collision
      if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
        gameOver();
        return;
      }
      
      // Self collision
      for (const segment of snake) {
        if (head.x === segment.x && head.y === segment.y) {
          gameOver();
          return;
        }
      }
      
      snake.unshift(head);
      
      // Food collision
      if (head.x === food.x && head.y === food.y) {
        score += 10;
        scoreEl.textContent = score;
        placeFood();
        
        if (window.clawd) {
          clawd.showToast(`+10! Score: ${score}`);
        }
      } else {
        snake.pop();
      }
      
      draw();
    }
    
    function startGame() {
      if (gameLoop) clearInterval(gameLoop);
      
      initGame();
      gameRunning = true;
      gamePaused = false;
      gameOverEl.classList.remove('show');
      startBtn.textContent = 'Restart';
      
      draw();
      gameLoop = setInterval(update, 100);
    }
    
    function pauseGame() {
      if (!gameRunning) return;
      gamePaused = !gamePaused;
      
      if (gamePaused && window.clawd) {
        clawd.showToast('Paused');
      }
    }
    
    function gameOver() {
      gameRunning = false;
      clearInterval(gameLoop);
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('snake-high-score', highScore);
        highScoreEl.textContent = highScore;
      }
      
      finalScoreEl.textContent = score;
      gameOverEl.classList.add('show');
    }
    
    function setDirection(newDx, newDy) {
      // Prevent reversing
      if (newDx !== 0 && dx === -newDx) return;
      if (newDy !== 0 && dy === -newDy) return;
      
      dx = newDx;
      dy = newDy;
    }
    
    // Keyboard controls
    document.addEventListener('keydown', (e) => {
      switch (e.key) {
        case 'ArrowUp':
        case 'w':
        case 'W':
          e.preventDefault();
          setDirection(0, -1);
          break;
        case 'ArrowDown':
        case 's':
        case 'S':
          e.preventDefault();
          setDirection(0, 1);
          break;
        case 'ArrowLeft':
        case 'a':
        case 'A':
          e.preventDefault();
          setDirection(-1, 0);
          break;
        case 'ArrowRight':
        case 'd':
        case 'D':
          e.preventDefault();
          setDirection(1, 0);
          break;
        case ' ':
          e.preventDefault();
          pauseGame();
          break;
        case 'Enter':
          if (!gameRunning) startGame();
          break;
      }
    });
    
    // Initial draw
    initGame();
    draw();
  </script>
</body>
</html>
