<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notes</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: #0d1117;
      color: #c9d1d9;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      height: 100vh;
      display: flex;
      overflow: hidden;
    }
    
    /* Sidebar */
    .sidebar {
      width: 240px;
      background: #161b22;
      border-right: 1px solid #30363d;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    
    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid #30363d;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .sidebar-title {
      font-size: 16px;
      font-weight: 600;
      color: #58a6ff;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .new-note-btn {
      background: #238636;
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .new-note-btn:hover {
      background: #2ea043;
    }
    
    .notes-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }
    
    .note-item {
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 4px;
      transition: background 0.15s;
    }
    
    .note-item:hover {
      background: #21262d;
    }
    
    .note-item.active {
      background: #21262d;
      border: 1px solid #58a6ff;
    }
    
    .note-item-title {
      font-size: 14px;
      font-weight: 500;
      color: #c9d1d9;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .note-item-preview {
      font-size: 12px;
      color: #8b949e;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .note-item-date {
      font-size: 11px;
      color: #6e7681;
      margin-top: 4px;
    }
    
    /* Editor */
    .editor-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .editor-header {
      padding: 12px 16px;
      border-bottom: 1px solid #30363d;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .editor-title-input {
      flex: 1;
      background: transparent;
      border: none;
      color: #c9d1d9;
      font-size: 18px;
      font-weight: 600;
      outline: none;
    }
    
    .editor-title-input::placeholder {
      color: #6e7681;
    }
    
    .editor-actions {
      display: flex;
      gap: 8px;
    }
    
    .editor-btn {
      background: #21262d;
      border: 1px solid #30363d;
      color: #8b949e;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .editor-btn:hover {
      background: #30363d;
      color: #c9d1d9;
    }
    
    .editor-btn.danger:hover {
      background: #da3633;
      border-color: #da3633;
      color: white;
    }
    
    .editor-content {
      flex: 1;
      padding: 16px;
      overflow: hidden;
    }
    
    .editor-textarea {
      width: 100%;
      height: 100%;
      background: transparent;
      border: none;
      color: #c9d1d9;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 14px;
      line-height: 1.6;
      resize: none;
      outline: none;
    }
    
    .editor-textarea::placeholder {
      color: #6e7681;
    }
    
    /* Empty state */
    .empty-state {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #8b949e;
    }
    
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }
    
    .empty-state-title {
      font-size: 18px;
      margin-bottom: 8px;
    }
    
    .empty-state-text {
      font-size: 14px;
    }
    
    /* Word count */
    .word-count {
      padding: 8px 16px;
      font-size: 12px;
      color: #6e7681;
      border-top: 1px solid #30363d;
      display: flex;
      justify-content: space-between;
    }
    
    /* Search */
    .search-box {
      padding: 8px;
      border-bottom: 1px solid #30363d;
    }
    
    .search-input {
      width: 100%;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 8px 12px;
      color: #c9d1d9;
      font-size: 13px;
      outline: none;
    }
    
    .search-input:focus {
      border-color: #58a6ff;
    }
    
    .search-input::placeholder {
      color: #6e7681;
    }
    
    /* Formatting toolbar */
    .format-toolbar {
      padding: 8px 16px;
      border-bottom: 1px solid #30363d;
      display: flex;
      gap: 4px;
    }
    
    .format-btn {
      background: #21262d;
      border: 1px solid #30363d;
      color: #8b949e;
      width: 32px;
      height: 32px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .format-btn:hover {
      background: #30363d;
      color: #c9d1d9;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <span class="sidebar-title">üìù Notes</span>
      <button class="new-note-btn" id="new-note-btn" title="New note">+</button>
    </div>
    <div class="search-box">
      <input type="text" class="search-input" id="search-input" placeholder="Search notes..." />
    </div>
    <div class="notes-list" id="notes-list"></div>
  </div>
  
  <!-- Editor -->
  <div class="editor-container" id="editor-container">
    <div class="empty-state" id="empty-state">
      <div class="empty-state-icon">üìù</div>
      <div class="empty-state-title">No note selected</div>
      <div class="empty-state-text">Create a new note or select one from the sidebar</div>
    </div>
    
    <div id="editor" style="display: none; flex-direction: column; flex: 1;">
      <div class="editor-header">
        <input type="text" class="editor-title-input" id="note-title" placeholder="Note title..." />
        <div class="editor-actions">
          <button class="editor-btn" id="copy-btn">üìã Copy</button>
          <button class="editor-btn danger" id="delete-btn">üóëÔ∏è Delete</button>
        </div>
      </div>
      <div class="format-toolbar">
        <button class="format-btn" data-format="bold" title="Bold"><b>B</b></button>
        <button class="format-btn" data-format="italic" title="Italic"><i>I</i></button>
        <button class="format-btn" data-format="heading" title="Heading">#</button>
        <button class="format-btn" data-format="list" title="List">‚Ä¢</button>
        <button class="format-btn" data-format="code" title="Code">&lt;/&gt;</button>
        <button class="format-btn" data-format="link" title="Link">üîó</button>
      </div>
      <div class="editor-content">
        <textarea class="editor-textarea" id="note-content" placeholder="Start writing..."></textarea>
      </div>
      <div class="word-count">
        <span id="word-count">0 words</span>
        <span id="save-status">Saved</span>
      </div>
    </div>
  </div>
  
  <!-- ClawdOS SDK -->
  <script src="https://clawdos.space/sdk/clawd-miniapp-sdk.js"></script>
  <script>
    // Initialize ClawdOS SDK
    if (window.clawd) {
      clawd.ready();
    }
    
    // State
    const state = {
      notes: [],
      activeNoteId: null,
      saveTimeout: null
    };
    
    // DOM elements
    const notesList = document.getElementById('notes-list');
    const emptyState = document.getElementById('empty-state');
    const editor = document.getElementById('editor');
    const noteTitle = document.getElementById('note-title');
    const noteContent = document.getElementById('note-content');
    const newNoteBtn = document.getElementById('new-note-btn');
    const deleteBtn = document.getElementById('delete-btn');
    const copyBtn = document.getElementById('copy-btn');
    const searchInput = document.getElementById('search-input');
    const wordCount = document.getElementById('word-count');
    const saveStatus = document.getElementById('save-status');
    
    // Load notes from localStorage
    function loadNotes() {
      try {
        const saved = localStorage.getItem('clawdos-notes');
        if (saved) {
          state.notes = JSON.parse(saved);
        } else {
          // Create welcome note
          state.notes = [{
            id: Date.now(),
            title: 'Welcome to Notes!',
            content: `# Welcome to ClawdOS Notes! üìù

This is your personal note-taking app for ClawdOS.

## Features:
- Create unlimited notes
- Auto-save as you type
- Search across all notes
- Markdown-style formatting
- Word count

## Keyboard shortcuts:
- Cmd/Ctrl + B: Bold
- Cmd/Ctrl + I: Italic
- Cmd/Ctrl + S: Save (auto-saves anyway!)

Happy writing! ü¶û`,
            createdAt: Date.now(),
            updatedAt: Date.now()
          }];
          saveNotes();
        }
      } catch (e) {
        state.notes = [];
      }
      renderNotesList();
    }
    
    // Save notes to localStorage
    function saveNotes() {
      try {
        localStorage.setItem('clawdos-notes', JSON.stringify(state.notes));
        saveStatus.textContent = 'Saved';
      } catch (e) {
        saveStatus.textContent = 'Error saving';
      }
    }
    
    // Render notes list
    function renderNotesList(searchTerm = '') {
      notesList.innerHTML = '';
      
      const filtered = state.notes.filter(note => {
        if (!searchTerm) return true;
        const term = searchTerm.toLowerCase();
        return note.title.toLowerCase().includes(term) || 
               note.content.toLowerCase().includes(term);
      });
      
      // Sort by updated date
      filtered.sort((a, b) => b.updatedAt - a.updatedAt);
      
      for (const note of filtered) {
        const item = document.createElement('div');
        item.className = 'note-item' + (note.id === state.activeNoteId ? ' active' : '');
        item.dataset.id = note.id;
        
        const preview = note.content.replace(/[#*_`]/g, '').slice(0, 50);
        const date = new Date(note.updatedAt);
        const dateStr = date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
        
        item.innerHTML = `
          <div class="note-item-title">${note.title || 'Untitled'}</div>
          <div class="note-item-preview">${preview || 'Empty note'}</div>
          <div class="note-item-date">${dateStr}</div>
        `;
        
        item.onclick = () => selectNote(note.id);
        notesList.appendChild(item);
      }
    }
    
    // Select a note
    function selectNote(id) {
      state.activeNoteId = id;
      const note = state.notes.find(n => n.id === id);
      
      if (note) {
        emptyState.style.display = 'none';
        editor.style.display = 'flex';
        noteTitle.value = note.title;
        noteContent.value = note.content;
        updateWordCount();
        
        if (window.clawd) {
          clawd.setTitle('Notes: ' + (note.title || 'Untitled'));
        }
      }
      
      renderNotesList(searchInput.value);
    }
    
    // Create new note
    function createNote() {
      const note = {
        id: Date.now(),
        title: '',
        content: '',
        createdAt: Date.now(),
        updatedAt: Date.now()
      };
      
      state.notes.unshift(note);
      saveNotes();
      selectNote(note.id);
      noteTitle.focus();
    }
    
    // Delete current note
    function deleteNote() {
      if (!state.activeNoteId) return;
      
      const index = state.notes.findIndex(n => n.id === state.activeNoteId);
      if (index !== -1) {
        state.notes.splice(index, 1);
        saveNotes();
        
        state.activeNoteId = null;
        emptyState.style.display = 'flex';
        editor.style.display = 'none';
        renderNotesList(searchInput.value);
        
        if (window.clawd) {
          clawd.setTitle('Notes');
        }
      }
    }
    
    // Update word count
    function updateWordCount() {
      const text = noteContent.value.trim();
      const words = text ? text.split(/\s+/).length : 0;
      const chars = text.length;
      wordCount.textContent = `${words} words, ${chars} chars`;
    }
    
    // Save current note
    function saveCurrentNote() {
      if (!state.activeNoteId) return;
      
      const note = state.notes.find(n => n.id === state.activeNoteId);
      if (note) {
        note.title = noteTitle.value;
        note.content = noteContent.value;
        note.updatedAt = Date.now();
        saveNotes();
        renderNotesList(searchInput.value);
      }
    }
    
    // Debounced save
    function scheduleSave() {
      saveStatus.textContent = 'Saving...';
      clearTimeout(state.saveTimeout);
      state.saveTimeout = setTimeout(() => {
        saveCurrentNote();
      }, 500);
    }
    
    // Format text
    function formatText(format) {
      const textarea = noteContent;
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selected = textarea.value.substring(start, end);
      
      let replacement;
      switch (format) {
        case 'bold':
          replacement = `**${selected || 'bold text'}**`;
          break;
        case 'italic':
          replacement = `*${selected || 'italic text'}*`;
          break;
        case 'heading':
          replacement = `\n# ${selected || 'Heading'}\n`;
          break;
        case 'list':
          replacement = `\n- ${selected || 'List item'}\n`;
          break;
        case 'code':
          replacement = selected.includes('\n') 
            ? `\n\`\`\`\n${selected || 'code'}\n\`\`\`\n`
            : `\`${selected || 'code'}\``;
          break;
        case 'link':
          replacement = `[${selected || 'link text'}](url)`;
          break;
        default:
          return;
      }
      
      textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
      textarea.focus();
      scheduleSave();
    }
    
    // Event listeners
    newNoteBtn.onclick = createNote;
    deleteBtn.onclick = deleteNote;
    
    copyBtn.onclick = () => {
      navigator.clipboard.writeText(noteContent.value).then(() => {
        saveStatus.textContent = 'Copied!';
        setTimeout(() => {
          saveStatus.textContent = 'Saved';
        }, 2000);
      });
    };
    
    noteTitle.oninput = () => {
      scheduleSave();
    };
    
    noteContent.oninput = () => {
      updateWordCount();
      scheduleSave();
    };
    
    searchInput.oninput = () => {
      renderNotesList(searchInput.value);
    };
    
    // Format toolbar
    document.querySelectorAll('.format-btn').forEach(btn => {
      btn.onclick = () => formatText(btn.dataset.format);
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch (e.key) {
          case 'b':
            e.preventDefault();
            formatText('bold');
            break;
          case 'i':
            e.preventDefault();
            formatText('italic');
            break;
          case 'n':
            e.preventDefault();
            createNote();
            break;
        }
      }
    });
    
    // Initialize
    loadNotes();
    
    if (window.clawd) {
      clawd.setTitle('Notes');
    }
  </script>
</body>
</html>
