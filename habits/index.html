<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Habit Tracker</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: #0d1117;
      color: #c9d1d9;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .title {
      font-size: 28px;
      font-weight: 700;
    }
    
    .date-nav {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .nav-btn {
      background: #21262d;
      border: 1px solid #30363d;
      color: #8b949e;
      width: 32px;
      height: 32px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    
    .nav-btn:hover { background: #30363d; color: #c9d1d9; }
    
    .current-date {
      font-size: 14px;
      color: #8b949e;
    }
    
    .add-habit {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
    }
    
    .add-input {
      flex: 1;
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 12px 16px;
      color: #c9d1d9;
      font-size: 14px;
      outline: none;
    }
    
    .add-input:focus { border-color: #58a6ff; }
    
    .add-btn {
      background: #238636;
      border: none;
      border-radius: 8px;
      color: white;
      padding: 12px 20px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .add-btn:hover { background: #2ea043; }
    
    .habits-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .habit-card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .habit-checkbox {
      width: 28px;
      height: 28px;
      background: #21262d;
      border: 2px solid #30363d;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
      transition: all 0.2s;
    }
    
    .habit-checkbox:hover { border-color: #58a6ff; }
    
    .habit-checkbox.checked {
      background: #238636;
      border-color: #238636;
      color: white;
    }
    
    .habit-info { flex: 1; }
    
    .habit-name {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .habit-streak {
      font-size: 12px;
      color: #8b949e;
    }
    
    .habit-streak .fire { color: #f0883e; }
    
    .habit-week {
      display: flex;
      gap: 4px;
    }
    
    .week-day {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      background: #21262d;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6e7681;
    }
    
    .week-day.completed { background: #238636; color: white; }
    .week-day.today { border: 1px solid #58a6ff; }
    
    .habit-delete {
      background: none;
      border: none;
      color: #6e7681;
      cursor: pointer;
      font-size: 18px;
      padding: 4px;
    }
    
    .habit-delete:hover { color: #f85149; }
    
    .stats {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 20px;
      margin-top: 24px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    
    .stat {
      text-align: center;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #58a6ff;
    }
    
    .stat-label {
      font-size: 12px;
      color: #8b949e;
      margin-top: 4px;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #8b949e;
    }
    
    .empty-icon { font-size: 48px; margin-bottom: 16px; }
    .empty-text { font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">üìä Habits</div>
      <div class="date-nav">
        <button class="nav-btn" id="prev-day">‚Üê</button>
        <span class="current-date" id="current-date">Today</span>
        <button class="nav-btn" id="next-day">‚Üí</button>
      </div>
    </div>
    
    <div class="add-habit">
      <input type="text" class="add-input" id="habit-input" placeholder="Add a new habit..." />
      <button class="add-btn" id="add-btn">Add</button>
    </div>
    
    <div class="habits-list" id="habits-list"></div>
    
    <div class="stats" id="stats"></div>
  </div>
  
  <script src="https://clawdos.space/sdk/clawd-miniapp-sdk.js"></script>
  <script>
    try { if (window.clawd) clawd.ready(); } catch(e) {}
    
    // State
    let habits = JSON.parse(localStorage.getItem('habits-data') || '[]');
    let completions = JSON.parse(localStorage.getItem('habits-completions') || '{}');
    let viewDate = new Date();
    viewDate.setHours(0, 0, 0, 0);
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // DOM
    const habitsList = document.getElementById('habits-list');
    const habitInput = document.getElementById('habit-input');
    const currentDateEl = document.getElementById('current-date');
    const statsEl = document.getElementById('stats');
    
    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }
    
    function getDateKey(date = viewDate) {
      return formatDate(date);
    }
    
    function getLast7Days() {
      const days = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(d.getDate() - i);
        days.push(d);
      }
      return days;
    }
    
    function getStreak(habitId) {
      let streak = 0;
      const checkDate = new Date(today);
      
      while (true) {
        const key = formatDate(checkDate);
        if (completions[key]?.includes(habitId)) {
          streak++;
          checkDate.setDate(checkDate.getDate() - 1);
        } else {
          break;
        }
      }
      return streak;
    }
    
    function isCompleted(habitId, date = viewDate) {
      const key = formatDate(date);
      return completions[key]?.includes(habitId) || false;
    }
    
    function toggleHabit(habitId) {
      const key = getDateKey();
      if (!completions[key]) completions[key] = [];
      
      const idx = completions[key].indexOf(habitId);
      if (idx >= 0) {
        completions[key].splice(idx, 1);
      } else {
        completions[key].push(habitId);
      }
      
      save();
      render();
    }
    
    function addHabit() {
      const name = habitInput.value.trim();
      if (!name) return;
      
      habits.push({
        id: Date.now().toString(),
        name,
        createdAt: new Date().toISOString()
      });
      
      habitInput.value = '';
      save();
      render();
    }
    
    function deleteHabit(id) {
      habits = habits.filter(h => h.id !== id);
      save();
      render();
    }
    
    function save() {
      localStorage.setItem('habits-data', JSON.stringify(habits));
      localStorage.setItem('habits-completions', JSON.stringify(completions));
    }
    
    function render() {
      // Update date display
      const isToday = formatDate(viewDate) === formatDate(today);
      if (isToday) {
        currentDateEl.textContent = 'Today';
      } else {
        currentDateEl.textContent = viewDate.toLocaleDateString('en-US', { 
          weekday: 'short', month: 'short', day: 'numeric' 
        });
      }
      
      // Render habits
      if (habits.length === 0) {
        habitsList.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üéØ</div>
            <div class="empty-text">No habits yet. Add one above!</div>
          </div>
        `;
      } else {
        const last7 = getLast7Days();
        const dayNames = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
        
        habitsList.innerHTML = habits.map(habit => {
          const completed = isCompleted(habit.id);
          const streak = getStreak(habit.id);
          
          return `
            <div class="habit-card">
              <div class="habit-checkbox ${completed ? 'checked' : ''}" onclick="toggleHabit('${habit.id}')">
                ${completed ? '‚úì' : ''}
              </div>
              <div class="habit-info">
                <div class="habit-name">${habit.name}</div>
                <div class="habit-streak">
                  ${streak > 0 ? `<span class="fire">üî•</span> ${streak} day streak` : 'Start your streak today!'}
                </div>
              </div>
              <div class="habit-week">
                ${last7.map(d => {
                  const done = isCompleted(habit.id, d);
                  const isToday = formatDate(d) === formatDate(today);
                  return `<div class="week-day ${done ? 'completed' : ''} ${isToday ? 'today' : ''}">${dayNames[d.getDay()]}</div>`;
                }).join('')}
              </div>
              <button class="habit-delete" onclick="deleteHabit('${habit.id}')">√ó</button>
            </div>
          `;
        }).join('');
      }
      
      // Render stats
      const totalCompleted = Object.values(completions).reduce((sum, arr) => sum + arr.length, 0);
      const todayCompleted = completions[formatDate(today)]?.length || 0;
      const longestStreak = habits.reduce((max, h) => Math.max(max, getStreak(h.id)), 0);
      
      statsEl.innerHTML = `
        <div class="stat">
          <div class="stat-value">${todayCompleted}/${habits.length}</div>
          <div class="stat-label">Today</div>
        </div>
        <div class="stat">
          <div class="stat-value">${longestStreak}</div>
          <div class="stat-label">Best Streak</div>
        </div>
        <div class="stat">
          <div class="stat-value">${totalCompleted}</div>
          <div class="stat-label">Total Done</div>
        </div>
      `;
    }
    
    // Event listeners
    document.getElementById('add-btn').addEventListener('click', addHabit);
    habitInput.addEventListener('keypress', e => { if (e.key === 'Enter') addHabit(); });
    
    document.getElementById('prev-day').addEventListener('click', () => {
      viewDate.setDate(viewDate.getDate() - 1);
      render();
    });
    
    document.getElementById('next-day').addEventListener('click', () => {
      if (formatDate(viewDate) < formatDate(today)) {
        viewDate.setDate(viewDate.getDate() + 1);
        render();
      }
    });
    
    // Make functions global for onclick handlers
    window.toggleHabit = toggleHabit;
    window.deleteHabit = deleteHabit;
    
    // Init
    render();
  </script>
</body>
</html>
